<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="css/d3Charts.css"/>
<link href='https://fonts.googleapis.com/css?family=Merriweather' rel='stylesheet'>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="js/d3Charts.js"></script>
<title>Chart Components</title>
<body>
<div class="chartTooltip"></div>
<div class="grid-container">
    <div class="grid-item" id="chart1Div"></div>
    <div class="grid-item" id="chart2Div"></div>
    <div class="grid-item" id="chart3Div"></div>
    <div class="grid-item" id="chart4Div"></div>
    <div class="grid-item" id="chart5Div"></div>
    <div class="grid-item" id="chart6Div"></div>
</div>

<script type="module">


    const getChartData = async () => {
        const data = await d3.csv("data/sampleData.csv");
        return data;

    }

    const brushResultsCallback = (brushedData) => {
        console.log(brushedData);
    }

    const drawChart = (type,divId,props, title) => {
        const div = d3.select(`#${divId}`);
        const {clientWidth, clientHeight} = div.node();

        let svg = div.select("svg");
        if (svg.node() === null) {
            svg = div
                .append("svg")
                .style("background-color","white")
                .attr("width", clientWidth)
                .attr("height",clientHeight);
        }
        if(type === "scatter"){
            // load charts
            const newScatterChart = scatterChart()
                .chartWidth(clientWidth)
                .chartHeight(clientHeight)
                .title(title)
                .brushResultsCallback(brushResultsCallback)
                .props(props);

            newScatterChart(svg);
        }
        if(type === "hBar"){
            // load charts
            const newHorizontalBarChart = horizontalBarChart()
                .chartWidth(clientWidth)
                .chartHeight(clientHeight)
                .chartClass(divId)
                .title(title)
                .props(props);

            newHorizontalBarChart(svg);
        }

        if(type === "pie"){
            const newPieChart = pieChart()
                .chartWidth(clientWidth)
                .chartHeight(clientHeight)
                .title(title)
                .props(props);

            newPieChart(svg);
        }
    }

    const sampleData = await getChartData();

    const scatter1Props =  {
        data: sampleData,
        dotAttributes: {
            radius: 8,
            opacity: 0.4,
            defaultFill: "#808080",
            highlightFill: "#de2d26",
        },
        format: {x:",",y:","},
        scales: {x: "scaleLinear", y: "scaleLinear"},
        fontSize: 14,
        labels: { xAxis: "Net Weight (kg)", yAxis: "Item Charge Amount (&#163;)" },
        tooltipVars: ["Net Weight Measure","Item Charge Amount"],
        xVar: "Net Weight Measure",
        yVar: "Item Charge Amount"
    }
    drawChart("scatter","chart1Div",scatter1Props, "Scatter Linear Scale");

    const scatter2Props =  {
        data: sampleData,
        dotAttributes: {
            radius: 8,
            opacity: 0.4,
            defaultFill: "#808080",
            highlightFill: "#de2d26",
            strokeWidth: 0.5
        },
        format: {x:",",y:","},
        scales: {x: "scaleLog", y: "scaleLog"},
        fontSize: 14,
        labels: { xAxis: "Net Weight (kg)", yAxis: "Item Charge Amount (&#163;)" },
        tooltipVars: ["Net Weight Measure","Item Charge Amount"],
        xVar: "Net Weight Measure",
        yVar: "Item Charge Amount"
    }
    drawChart("scatter","chart2Div",scatter2Props, "Scatter Log Scale");

    const hBar1Props =  {
        data: sampleData,
        barAttributes: {
            cornerRadius: 2,
            fill: "#3182bd"
        },
        format: {x:",.0f",y:""},
        fontSize: 14,
        labels: { xAxis: "Item Charge Amount (&#163;)", yAxis: "Non Preferential Country Code"},
        tooltipVars: ["Net Weight Measure","Item Charge Amount"],
        xVar: "Item Charge Amount",
        yVar: "Non Preferential Country Code",
        ySort: "descending",
    }
    drawChart("hBar","chart3Div",hBar1Props, "Horizontal Bar");

    const hBar2Props =  {
        data: sampleData,
        barAttributes: {
            cornerRadius: 2,
            fill: "#3182bd"
        },
        format: {x:",.0f",y:""},
        labels: { xAxis: "Item Charge Amount (&#163;)", yAxis: "Non Preferential Country Code"},
        tooltipVars: ["Net Weight Measure","Item Charge Amount"],
        topX: 15,
        xVar: "Item Charge Amount",
        yVar: "Commodity Code",
        ySort: "descending",
    }
    drawChart("hBar","chart4Div",hBar2Props, "Horizontal Bar Top 15");

    const hBar3Props =  {
        data: sampleData,
        barAttributes: {
            cornerRadius: 2,
            fill: "#3182bd"
        },
        format: {x:",.0f",y:""},
        labels: { xAxis: "Item Charge Amount (&#163;)", yAxis: "Non Preferential Country Code"},
        tooltipVars: ["Net Weight Measure","Item Charge Amount"],
        greaterThan: 10000,
        xVar: "Item Charge Amount",
        yVar: "Commodity Code",
        ySort: "descending",
    }
    drawChart("hBar","chart5Div",hBar3Props, "Horizontal Bar - greater than 10,000 filter");

    const pieProps = {
        data: sampleData,
        fontSize: 14,
        format:",.0f",
        pieVars: ["DTF.Duty.Amount","DTF.Duty.Relieved"],
        pieColors: ["#3182bd","#A0A0A0"],
        donutWidthRatio: 0.2
    }

    drawChart("pie","chart6Div",pieProps,"Pie Chart")


</script>
</body>
</html>
